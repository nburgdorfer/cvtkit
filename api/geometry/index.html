
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../datasets_dtu/">
      
      
        <link rel="next" href="../filtering/">
      
      
      <link rel="icon" href="../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.19">
    
    
      
        <title>cvt.geometry - Computer Vision Toolkit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cvtkit.geometry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Computer Vision Toolkit" class="md-header__button md-logo" aria-label="Computer Vision Toolkit" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Computer Vision Toolkit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              cvt.geometry
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/nburgdorfer/cvtkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    nbugdorfer/cvtkit
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/gen_vis_maps/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../camera/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../resources/pose_file_formats/" class="md-tabs__link">
          
  
  
  Resources

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/contrib/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Computer Vision Toolkit" class="md-nav__button md-logo" aria-label="Computer Vision Toolkit" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Computer Vision Toolkit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nburgdorfer/cvtkit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    nbugdorfer/cvtkit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computer Vision Toolkit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/gen_vis_maps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generate Visibility Maps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/mesh_to_gif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mesh To GIF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/mesh_to_vid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mesh To Video
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/cloud_to_gif/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Point Cloud To GIF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/cloud_to_vid/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Point Cloud To Video
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../camera/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.camera
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    cvt.datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            cvt.datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets_dtu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.datasets.dtu
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    cvt.geometry
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    cvt.geometry
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry" class="md-nav__link">
    <span class="md-ellipsis">
      geometry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.depth_to_normal" class="md-nav__link">
    <span class="md-ellipsis">
      depth_to_normal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.essential_from_features" class="md-nav__link">
    <span class="md-ellipsis">
      essential_from_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.fundamental_from_KP" class="md-nav__link">
    <span class="md-ellipsis">
      fundamental_from_KP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.fundamental_from_features" class="md-nav__link">
    <span class="md-ellipsis">
      fundamental_from_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.geometric_consistency_error" class="md-nav__link">
    <span class="md-ellipsis">
      geometric_consistency_error
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.geometric_consistency_mask" class="md-nav__link">
    <span class="md-ellipsis">
      geometric_consistency_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.homography" class="md-nav__link">
    <span class="md-ellipsis">
      homography
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.homography_warp" class="md-nav__link">
    <span class="md-ellipsis">
      homography_warp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.homography_warp_var" class="md-nav__link">
    <span class="md-ellipsis">
      homography_warp_var
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.load_pretrained_model" class="md-nav__link">
    <span class="md-ellipsis">
      load_pretrained_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.match_features" class="md-nav__link">
    <span class="md-ellipsis">
      match_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.plane_coords" class="md-nav__link">
    <span class="md-ellipsis">
      plane_coords
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.project_depth_map" class="md-nav__link">
    <span class="md-ellipsis">
      project_depth_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.project_depth_map_batched" class="md-nav__link">
    <span class="md-ellipsis">
      project_depth_map_batched
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.project_renderer" class="md-nav__link">
    <span class="md-ellipsis">
      project_renderer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.psv" class="md-nav__link">
    <span class="md-ellipsis">
      psv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_cams_sfm" class="md-nav__link">
    <span class="md-ellipsis">
      read_cams_sfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_cams_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      read_cams_trajectory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_cluster_list" class="md-nav__link">
    <span class="md-ellipsis">
      read_cluster_list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_extrinsics_tum" class="md-nav__link">
    <span class="md-ellipsis">
      read_extrinsics_tum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      read_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      read_mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_pfm" class="md-nav__link">
    <span class="md-ellipsis">
      read_pfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_point_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      read_point_cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_point_cloud_np" class="md-nav__link">
    <span class="md-ellipsis">
      read_point_cloud_np
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_single_cam_sfm" class="md-nav__link">
    <span class="md-ellipsis">
      read_single_cam_sfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_stereo_intrinsics_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      read_stereo_intrinsics_yaml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.render_custom_values" class="md-nav__link">
    <span class="md-ellipsis">
      render_custom_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.render_point_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      render_point_cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.render_point_cloud_single" class="md-nav__link">
    <span class="md-ellipsis">
      render_point_cloud_single
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.reproject" class="md-nav__link">
    <span class="md-ellipsis">
      reproject
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.resolution_based_hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      resolution_based_hypothesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.rigid_transform" class="md-nav__link">
    <span class="md-ellipsis">
      rigid_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.sample_volume" class="md-nav__link">
    <span class="md-ellipsis">
      sample_volume
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.save_model" class="md-nav__link">
    <span class="md-ellipsis">
      save_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.soft_hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      soft_hypothesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.uniform_hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      uniform_hypothesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.visibility" class="md-nav__link">
    <span class="md-ellipsis">
      visibility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.visibility_mask" class="md-nav__link">
    <span class="md-ellipsis">
      visibility_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_cam_sfm" class="md-nav__link">
    <span class="md-ellipsis">
      write_cam_sfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      write_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      write_mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_pfm" class="md-nav__link">
    <span class="md-ellipsis">
      write_pfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.y_axis_rotation" class="md-nav__link">
    <span class="md-ellipsis">
      y_axis_rotation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../filtering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.filtering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    cvt.visualization
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            cvt.visualization
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization_latex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.visualization.latex
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization_util/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.visualization.util
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization_video/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cvt.visualization.video
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../resources/pose_file_formats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pose File Formats
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/contrib/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/conduct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry" class="md-nav__link">
    <span class="md-ellipsis">
      geometry
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.depth_to_normal" class="md-nav__link">
    <span class="md-ellipsis">
      depth_to_normal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.essential_from_features" class="md-nav__link">
    <span class="md-ellipsis">
      essential_from_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.fundamental_from_KP" class="md-nav__link">
    <span class="md-ellipsis">
      fundamental_from_KP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.fundamental_from_features" class="md-nav__link">
    <span class="md-ellipsis">
      fundamental_from_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.geometric_consistency_error" class="md-nav__link">
    <span class="md-ellipsis">
      geometric_consistency_error
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.geometric_consistency_mask" class="md-nav__link">
    <span class="md-ellipsis">
      geometric_consistency_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.homography" class="md-nav__link">
    <span class="md-ellipsis">
      homography
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.homography_warp" class="md-nav__link">
    <span class="md-ellipsis">
      homography_warp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.homography_warp_var" class="md-nav__link">
    <span class="md-ellipsis">
      homography_warp_var
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.load_pretrained_model" class="md-nav__link">
    <span class="md-ellipsis">
      load_pretrained_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.match_features" class="md-nav__link">
    <span class="md-ellipsis">
      match_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.plane_coords" class="md-nav__link">
    <span class="md-ellipsis">
      plane_coords
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.project_depth_map" class="md-nav__link">
    <span class="md-ellipsis">
      project_depth_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.project_depth_map_batched" class="md-nav__link">
    <span class="md-ellipsis">
      project_depth_map_batched
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.project_renderer" class="md-nav__link">
    <span class="md-ellipsis">
      project_renderer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.psv" class="md-nav__link">
    <span class="md-ellipsis">
      psv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_cams_sfm" class="md-nav__link">
    <span class="md-ellipsis">
      read_cams_sfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_cams_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      read_cams_trajectory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_cluster_list" class="md-nav__link">
    <span class="md-ellipsis">
      read_cluster_list
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_extrinsics_tum" class="md-nav__link">
    <span class="md-ellipsis">
      read_extrinsics_tum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      read_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      read_mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_pfm" class="md-nav__link">
    <span class="md-ellipsis">
      read_pfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_point_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      read_point_cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_point_cloud_np" class="md-nav__link">
    <span class="md-ellipsis">
      read_point_cloud_np
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_single_cam_sfm" class="md-nav__link">
    <span class="md-ellipsis">
      read_single_cam_sfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.read_stereo_intrinsics_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      read_stereo_intrinsics_yaml
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.render_custom_values" class="md-nav__link">
    <span class="md-ellipsis">
      render_custom_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.render_point_cloud" class="md-nav__link">
    <span class="md-ellipsis">
      render_point_cloud
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.render_point_cloud_single" class="md-nav__link">
    <span class="md-ellipsis">
      render_point_cloud_single
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.reproject" class="md-nav__link">
    <span class="md-ellipsis">
      reproject
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.resolution_based_hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      resolution_based_hypothesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.rigid_transform" class="md-nav__link">
    <span class="md-ellipsis">
      rigid_transform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.sample_volume" class="md-nav__link">
    <span class="md-ellipsis">
      sample_volume
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.save_model" class="md-nav__link">
    <span class="md-ellipsis">
      save_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.soft_hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      soft_hypothesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.uniform_hypothesis" class="md-nav__link">
    <span class="md-ellipsis">
      uniform_hypothesis
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.visibility" class="md-nav__link">
    <span class="md-ellipsis">
      visibility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.visibility_mask" class="md-nav__link">
    <span class="md-ellipsis">
      visibility_mask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_cam_sfm" class="md-nav__link">
    <span class="md-ellipsis">
      write_cam_sfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      write_matrix
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_mesh" class="md-nav__link">
    <span class="md-ellipsis">
      write_mesh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.write_pfm" class="md-nav__link">
    <span class="md-ellipsis">
      write_pfm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cvtkit.geometry.y_axis_rotation" class="md-nav__link">
    <span class="md-ellipsis">
      y_axis_rotation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>cvt.geometry</h1>

<div class="doc doc-object doc-module">



<a id="cvtkit.geometry"></a>
    <div class="doc doc-contents first">

        <p>Module including geometric routines.</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.depth_to_normal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">depth_to_normal</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>view: view camera
depth: depthmap</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">depth_to_normal</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        view: view camera</span>
<span class="sd">        depth: depthmap </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">project_depth_map</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">KP_inv</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">normal_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">normal_map</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.essential_from_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">essential_from_features</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">,</span> <span class="n">tgt_image_file</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the essential matrix between two images using image features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_image_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file for the source image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_image_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file for the target image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>K</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsics matrix of the two cameras (assumed to be constant between views).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The essential matrix betweent the two image views.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">essential_from_features</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tgt_image_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">K</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the essential matrix between two images using image features.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        src_image_file: Input file for the source image.</span>
<span class="sd">        tgt_image_file: Input file for the target image.</span>
<span class="sd">        K: Intrinsics matrix of the two cameras (assumed to be constant between views).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The essential matrix betweent the two image views.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">)</span>
    <span class="n">tgt_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">tgt_image_file</span><span class="p">)</span>

    <span class="c1"># compute matching features</span>
    <span class="p">(</span><span class="n">src_points</span><span class="p">,</span> <span class="n">tgt_points</span><span class="p">)</span> <span class="o">=</span> <span class="n">match_features</span><span class="p">(</span><span class="n">src_image</span><span class="p">,</span> <span class="n">tgt_image</span><span class="p">)</span>

    <span class="c1"># Compute fundamental matrix</span>
    <span class="n">E</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findEssentialMat</span><span class="p">(</span><span class="n">src_points</span><span class="p">,</span> <span class="n">tgt_points</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">E</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.fundamental_from_KP" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fundamental_from_KP</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">P_src</span><span class="p">,</span> <span class="n">P_tgt</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the fundamental matrix between two images using camera parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>K</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsics matrix of the two cameras (assumed to be constant between views).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>P_src</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extrinsics matrix for the source view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>P_tgt</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extrinsics matrix for the target view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fundamental matrix betweent the two cameras.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fundamental_from_KP</span><span class="p">(</span><span class="n">K</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">P_src</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">P_tgt</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the fundamental matrix between two images using camera parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        K: Intrinsics matrix of the two cameras (assumed to be constant between views).</span>
<span class="sd">        P_src: Extrinsics matrix for the source view.</span>
<span class="sd">        P_tgt: Extrinsics matrix for the target view.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The fundamental matrix betweent the two cameras.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F_mats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">R1</span> <span class="o">=</span> <span class="n">P_src</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">P_src</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">R2</span> <span class="o">=</span> <span class="n">P_tgt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">P_tgt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">t1aug</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
        <span class="n">epi2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">P_tgt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">t1aug</span><span class="p">)</span>
        <span class="n">epi2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">epi2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">R</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R2</span><span class="p">,</span><span class="n">torch</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">R1</span><span class="p">))</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span>
        <span class="n">K1inv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">K2invT</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">K1inv</span><span class="p">)</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">K2invT</span><span class="p">,</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">K1inv</span><span class="p">)))</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>
        <span class="n">F_mats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">F_mats</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.fundamental_from_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fundamental_from_features</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">,</span> <span class="n">tgt_image_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the fundamental matrix between two images using image features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_image_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file for the source image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_image_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file for the target image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fundamental matrix betweent the two image views.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fundamental_from_features</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tgt_image_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the fundamental matrix between two images using image features.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        src_image_file: Input file for the source image.</span>
<span class="sd">        tgt_image_file: Input file for the target image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The fundamental matrix betweent the two image views.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">)</span>
    <span class="n">tgt_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">tgt_image_file</span><span class="p">)</span>

    <span class="c1"># compute matching features</span>
    <span class="p">(</span><span class="n">src_points</span><span class="p">,</span> <span class="n">tgt_points</span><span class="p">)</span> <span class="o">=</span> <span class="n">match_features</span><span class="p">(</span><span class="n">src_image</span><span class="p">,</span> <span class="n">tgt_image</span><span class="p">)</span>

    <span class="c1"># Compute fundamental matrix</span>
    <span class="n">F</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findFundamentalMat</span><span class="p">(</span><span class="n">src_points</span><span class="p">,</span><span class="n">tgt_points</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">FM_8POINT</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">F</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.geometric_consistency_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">geometric_consistency_error</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_cam</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_cam</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the geometric consistency error between a source and target depth map.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_depth</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Depth map for the source view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_cam</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera parameters for the source depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_depth</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Depth map for the target view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_cam</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera parameters for the target depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary consistency mask encoding depth consensus between source and target depth maps.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">geometric_consistency_error</span><span class="p">(</span><span class="n">src_depth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">src_cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tgt_cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the geometric consistency error between a source and target depth map.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        src_depth: Depth map for the source view.</span>
<span class="sd">        src_cam: Camera parameters for the source depth map viewpoint.</span>
<span class="sd">        tgt_depth: Depth map for the target view.</span>
<span class="sd">        tgt_cam: Camera parameters for the target depth map viewpoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The binary consistency mask encoding depth consensus between source and target depth maps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">src_depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">x_src</span><span class="p">,</span> <span class="n">y_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

    <span class="n">depth_reprojected</span><span class="p">,</span> <span class="n">coords_reprojected</span><span class="p">,</span> <span class="n">coords_tgt</span><span class="p">,</span> <span class="n">projection_map</span> <span class="o">=</span> <span class="n">reproject</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_cam</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_cam</span><span class="p">)</span>

    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">coords_reprojected</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_src</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords_reprojected</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_src</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dist</span><span class="p">,</span> <span class="n">projection_map</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.geometric_consistency_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">geometric_consistency_mask</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_K</span><span class="p">,</span> <span class="n">src_P</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_K</span><span class="p">,</span> <span class="n">tgt_P</span><span class="p">,</span> <span class="n">pixel_th</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the geometric consistency mask between a source and target depth map.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_depth</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Depth map for the source view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_K</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsic camera parameters for the source depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_P</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extrinsic camera parameters for the source depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_depth</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target depth map used for re-projection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_K</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsic camera parameters for the target depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_P</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extrinsic camera parameters for the target depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_th</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pixel re-projection threshold to determine matching depth estimates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The binary consistency mask encoding depth consensus between source and target depth maps.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">geometric_consistency_mask</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_K</span><span class="p">,</span> <span class="n">src_P</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_K</span><span class="p">,</span> <span class="n">tgt_P</span><span class="p">,</span> <span class="n">pixel_th</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the geometric consistency mask between a source and target depth map.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        src_depth: Depth map for the source view.</span>
<span class="sd">        src_K: Intrinsic camera parameters for the source depth map viewpoint.</span>
<span class="sd">        src_P: Extrinsic camera parameters for the source depth map viewpoint.</span>
<span class="sd">        tgt_depth: Target depth map used for re-projection.</span>
<span class="sd">        tgt_K: Intrinsic camera parameters for the target depth map viewpoint.</span>
<span class="sd">        tgt_P: Extrinsic camera parameters for the target depth map viewpoint.</span>
<span class="sd">        pixel_th: Pixel re-projection threshold to determine matching depth estimates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The binary consistency mask encoding depth consensus between source and target depth maps.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_size</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">src_depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">depth_reprojected</span><span class="p">,</span> <span class="n">coords_reprojected</span><span class="p">,</span> <span class="n">coords_tgt</span> <span class="o">=</span> <span class="n">reproject</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_K</span><span class="p">,</span> <span class="n">src_P</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_K</span><span class="p">,</span> <span class="n">tgt_P</span><span class="p">)</span>

    <span class="n">x_src</span><span class="p">,</span> <span class="n">y_src</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
    <span class="n">x_src</span> <span class="o">=</span> <span class="n">x_src</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_depth</span><span class="p">)</span>
    <span class="n">y_src</span> <span class="o">=</span> <span class="n">y_src</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_depth</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">coords_reprojected</span><span class="p">[:,:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_src</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords_reprojected</span><span class="p">[:,:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_src</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">&lt;</span> <span class="n">pixel_th</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.homography" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">homography</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">,</span> <span class="n">tgt_image_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes a homography transformation between two images using image features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_image_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file for the source image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_image_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file for the target image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The homography matrix to warp the target image to the source image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">homography</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tgt_image_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes a homography transformation between two images using image features.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        src_image_file: Input file for the source image.</span>
<span class="sd">        tgt_image_file: Input file for the target image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The homography matrix to warp the target image to the source image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">src_image_file</span><span class="p">)</span>
    <span class="n">tgt_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">tgt_image_file</span><span class="p">)</span>

    <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">src_image</span><span class="o">.</span><span class="n">shape</span>

    <span class="p">(</span><span class="n">src_points</span><span class="p">,</span> <span class="n">tgt_points</span><span class="p">)</span> <span class="o">=</span> <span class="n">match_features</span><span class="p">(</span><span class="n">src_image</span><span class="p">,</span> <span class="n">tgt_image</span><span class="p">)</span>

    <span class="c1"># Compute fundamental matrix</span>
    <span class="n">H</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span><span class="n">tgt_points</span><span class="p">,</span> <span class="n">src_points</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">H</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.homography_warp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">homography_warp</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">,</span> <span class="n">extrinsics</span><span class="p">,</span> <span class="n">hypotheses</span><span class="p">,</span> <span class="n">group_channels</span><span class="p">,</span> <span class="n">vwa_net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">virtual</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Performs homography warping to create a Plane Sweeping Volume (PSV).
Parameters:
    cfg: Configuration dictionary containing configuration parameters.
    features: Feature maps to be warped into a PSV.
    intrinsics: Intrinsics matrices for all views.
    extrinsics: Extrinsics matrices for all views.
    hypotheses: Depth hypotheses to use for homography warping.
    group_channels: Feature channel sizes used in group-wise correlation (GWC).
    vwa_net: Network used for visibility weighting.
    vis_weights: Pre-computed visibility weights.
    virtual: If True, reference camera is not used in computing feature correlation (virtual reference camera)</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plane Sweeping Volume computed via feature matching cost.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">homography_warp</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">,</span> <span class="n">extrinsics</span><span class="p">,</span> <span class="n">hypotheses</span><span class="p">,</span> <span class="n">group_channels</span><span class="p">,</span> <span class="n">vwa_net</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">view_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">virtual</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs homography warping to create a Plane Sweeping Volume (PSV).</span>
<span class="sd">    Parameters:</span>
<span class="sd">        cfg: Configuration dictionary containing configuration parameters.</span>
<span class="sd">        features: Feature maps to be warped into a PSV.</span>
<span class="sd">        intrinsics: Intrinsics matrices for all views.</span>
<span class="sd">        extrinsics: Extrinsics matrices for all views.</span>
<span class="sd">        hypotheses: Depth hypotheses to use for homography warping.</span>
<span class="sd">        group_channels: Feature channel sizes used in group-wise correlation (GWC).</span>
<span class="sd">        vwa_net: Network used for visibility weighting.</span>
<span class="sd">        vis_weights: Pre-computed visibility weights.</span>
<span class="sd">        virtual: If True, reference camera is not used in computing feature correlation (virtual reference camera)</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Plane Sweeping Volume computed via feature matching cost.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hypotheses</span> <span class="o">=</span> <span class="n">hypotheses</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">hypotheses</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">batch_size</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">num_views</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">virtual</span><span class="p">:</span>
        <span class="n">ref_volume</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">vis_weight_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cost_volume</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span><span class="n">group_channels</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">reweight_sum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># build reference projection matrix</span>
    <span class="n">ref_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">intrinsics</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">extrinsics</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
    <span class="n">ref_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">ref_proj</span><span class="p">,</span> <span class="n">last</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># build coordinates grid</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span>
                        <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)],</span>
                        <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">contiguous</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">width</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">num_views</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="c1"># build source projection matrix</span>
            <span class="n">src_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">intrinsics</span><span class="p">[:,</span><span class="n">v</span><span class="p">],</span> <span class="n">extrinsics</span><span class="p">[:,</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">src_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">src_proj</span><span class="p">,</span> <span class="n">last</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># compute full projection matrix between views</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">src_proj</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">ref_proj</span><span class="p">))</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

            <span class="c1"># Build plane-sweeping coordinates grid between views</span>
            <span class="n">rot_xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">rot</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
            <span class="n">rot_depth_xyz</span> <span class="o">=</span> <span class="n">rot_xyz</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">hypotheses</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">height</span><span class="o">*</span><span class="n">width</span><span class="p">)</span>
            <span class="n">proj_xyz</span> <span class="o">=</span> <span class="n">rot_depth_xyz</span> <span class="o">+</span> <span class="n">trans</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">proj_xy</span> <span class="o">=</span> <span class="n">proj_xyz</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">proj_xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">proj_x_normalized</span> <span class="o">=</span> <span class="n">proj_xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">((</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">proj_y_normalized</span> <span class="o">=</span> <span class="n">proj_xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">((</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">proj_xy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">proj_x_normalized</span><span class="p">,</span> <span class="n">proj_y_normalized</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">proj_xy</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">src_feature</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="n">warped_features</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span> <span class="n">src_feature</span><span class="p">,</span>
                                        <span class="n">grid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">planes</span> <span class="o">*</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
                                        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span>
                                        <span class="n">padding_mode</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
                                        <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">warped_features</span> <span class="o">=</span> <span class="n">warped_features</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">virtual</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># We continue to the next source view to compute inner product</span>
                <span class="c1"># using the first source view is used as reference</span>
                <span class="n">ref_volume</span> <span class="o">=</span> <span class="n">warped_features</span>
                <span class="k">continue</span>

        <span class="c1"># compute Pairwise Plane-Sweeping Volume using GWC</span>
        <span class="n">ppsv</span> <span class="o">=</span> <span class="n">groupwise_correlation</span><span class="p">(</span><span class="n">warped_features</span><span class="p">,</span> <span class="n">ref_volume</span><span class="p">,</span> <span class="n">group_channels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vwa_net</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reweight</span> <span class="o">=</span> <span class="n">vwa_net</span><span class="p">(</span><span class="n">ppsv</span><span class="p">)</span>
            <span class="n">vis_weight_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reweight</span><span class="p">)</span>
            <span class="n">reweight</span> <span class="o">=</span> <span class="n">reweight</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ppsv</span> <span class="o">=</span> <span class="n">reweight</span><span class="o">*</span><span class="n">ppsv</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">assert</span> <span class="n">view_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">reweight</span> <span class="o">=</span> <span class="n">view_weights</span><span class="p">[</span><span class="n">v</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">reweight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ppsv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">reweight</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">reweight</span><span class="p">,</span><span class="n">scale_factor</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span><span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">vis_weight_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reweight</span><span class="p">)</span>
            <span class="n">reweight</span> <span class="o">=</span> <span class="n">reweight</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ppsv</span> <span class="o">=</span> <span class="n">reweight</span><span class="o">*</span><span class="n">ppsv</span>

        <span class="n">cost_volume</span> <span class="o">=</span> <span class="n">cost_volume</span> <span class="o">+</span> <span class="n">ppsv</span>
        <span class="n">reweight_sum</span> <span class="o">=</span> <span class="n">reweight_sum</span> <span class="o">+</span> <span class="n">reweight</span>

        <span class="c1"># if mode == &quot;inference&quot;:</span>
        <span class="c1">#     del src_feature</span>
        <span class="c1">#     del ppsv</span>
        <span class="c1">#     del warped_features</span>
        <span class="c1">#     del reweight</span>
        <span class="c1">#     torch.cuda.empty_cache()</span>

    <span class="n">cost_volume</span> <span class="o">=</span> <span class="n">cost_volume</span><span class="o">/</span><span class="p">(</span><span class="n">reweight_sum</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cost_volume</span><span class="p">,</span> <span class="n">vis_weight_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.homography_warp_var" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">homography_warp_var</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">ref_in</span><span class="p">,</span> <span class="n">src_in</span><span class="p">,</span> <span class="n">ref_ex</span><span class="p">,</span> <span class="n">src_ex</span><span class="p">,</span> <span class="n">depth_hypos</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Performs homography warping to create a Plane Sweeping Volume (PSV).
Parameters:
    cfg: Configuration dictionary containing configuration parameters.
    features: Feature maps to be warped into a PSV.
    level: Current feature resolution level.
    ref_in: Reference view intrinsics matrix.
    src_in: Source view intrinsics matrices.
    ref_ex: Reference view extrinsics matrix.
    src_ex: Source view extrinsics matrices.
    depth_hypos: Depth hypotheses to use for homography warping.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plane Sweeping Volume computed via feature matching cost.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">homography_warp_var</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">ref_in</span><span class="p">,</span> <span class="n">src_in</span><span class="p">,</span> <span class="n">ref_ex</span><span class="p">,</span> <span class="n">src_ex</span><span class="p">,</span> <span class="n">depth_hypos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs homography warping to create a Plane Sweeping Volume (PSV).</span>
<span class="sd">    Parameters:</span>
<span class="sd">        cfg: Configuration dictionary containing configuration parameters.</span>
<span class="sd">        features: Feature maps to be warped into a PSV.</span>
<span class="sd">        level: Current feature resolution level.</span>
<span class="sd">        ref_in: Reference view intrinsics matrix.</span>
<span class="sd">        src_in: Source view intrinsics matrices.</span>
<span class="sd">        ref_ex: Reference view extrinsics matrix.</span>
<span class="sd">        src_ex: Source view extrinsics matrices.</span>
<span class="sd">        depth_hypos: Depth hypotheses to use for homography warping.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Plane Sweeping Volume computed via feature matching cost.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">depth_hypos</span> <span class="o">=</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">B</span><span class="p">,</span><span class="n">fCH</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">num_depth</span> <span class="o">=</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nSrc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

    <span class="n">vis_weight_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ref_volume</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">num_depth</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">cost_volume</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nSrc</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">fCH</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cost_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_volume</span>
    <span class="n">reweight_sum</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSrc</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">autocast</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">src_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">src_in</span><span class="p">[:,</span><span class="n">src</span><span class="p">,:,:],</span><span class="n">src_ex</span><span class="p">[:,</span><span class="n">src</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,:])</span>
                <span class="n">ref_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">ref_in</span><span class="p">,</span><span class="n">ref_ex</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,:])</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src_in</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
                <span class="n">src_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">src_proj</span><span class="p">,</span><span class="n">last</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">ref_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">ref_proj</span><span class="p">,</span><span class="n">last</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">src_proj</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">ref_proj</span><span class="p">))</span>
                <span class="n">rot</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># [B,3,3]</span>
                <span class="n">trans</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># [B,3,1]</span>

                <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">ref_volume</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                                    <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">ref_volume</span><span class="o">.</span><span class="n">device</span><span class="p">)],</span>
                                    <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">contiguous</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">W</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1"># [3, H*W]</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B, 3, H*W]</span>
                <span class="n">rot_xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">rot</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>  <span class="c1"># [B, 3, H*W]</span>

                <span class="n">rot_depth_xyz</span> <span class="o">=</span> <span class="n">rot_xyz</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_depth</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_depth</span><span class="p">,</span><span class="n">H</span><span class="o">*</span><span class="n">W</span><span class="p">)</span>  <span class="c1"># [B, 3, Ndepth, H*W]</span>
                <span class="n">proj_xyz</span> <span class="o">=</span> <span class="n">rot_depth_xyz</span> <span class="o">+</span> <span class="n">trans</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B, 3, Ndepth, H*W]</span>
                <span class="n">proj_xy</span> <span class="o">=</span> <span class="n">proj_xyz</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">proj_xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># [B, 2, Ndepth, H*W]</span>
                <span class="n">proj_x_normalized</span> <span class="o">=</span> <span class="n">proj_xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="p">((</span><span class="n">W</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">proj_y_normalized</span> <span class="o">=</span> <span class="n">proj_xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">proj_xy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">proj_x_normalized</span><span class="p">,</span> <span class="n">proj_y_normalized</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># [B, Ndepth, H*W, 2]</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">proj_xy</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">ref_volume</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">warped_src_fea</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span> <span class="n">features</span><span class="p">[</span><span class="n">src</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                                        <span class="n">grid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">num_depth</span> <span class="o">*</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
                                        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span>
                                        <span class="n">padding_mode</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
                                        <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cost_volume</span><span class="p">[</span><span class="n">src</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">warped_src_fea</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">fCH</span><span class="p">,</span> <span class="n">num_depth</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>

    <span class="n">cost_volume</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">cost_volume</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span> <span class="o">=</span> <span class="n">cost_volume</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">return</span> <span class="n">cost_volume</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.load_pretrained_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_pretrained_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ckpt</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Loads model weights from disk.</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_pretrained_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">ckpt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads model weights from disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading model from: </span><span class="si">{</span><span class="n">ckpt</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ckpt</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed loading network weights...&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.match_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">match_features</span><span class="p">(</span><span class="n">src_image</span><span class="p">,</span> <span class="n">tgt_image</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computer matching ORB features between a pair of images.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_image</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source image to compute and match features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_image</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target image to compute and match features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_features</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of features to retain.</p>
              </div>
            </td>
            <td>
                  <code>500</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>src_points</code></td>            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The set of matched point coordinates for the source image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>tgt_points</code></td>            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The set of matched point coordinates for the target image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">match_features</span><span class="p">(</span><span class="n">src_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">tgt_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">max_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computer matching ORB features between a pair of images.</span>

<span class="sd">    Args:</span>
<span class="sd">        src_image: The source image to compute and match features.</span>
<span class="sd">        tgt_image: The target image to compute and match features.</span>
<span class="sd">        max_features: The maximum number of features to retain.</span>

<span class="sd">    Returns:</span>
<span class="sd">        src_points: The set of matched point coordinates for the source image.</span>
<span class="sd">        tgt_points: The set of matched point coordinates for the target image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">src_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">src_image</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">tgt_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">tgt_image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>

    <span class="n">orb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">ORB_create</span><span class="p">(</span><span class="n">max_features</span><span class="p">)</span>

    <span class="n">src_keypoints</span><span class="p">,</span> <span class="n">src_descriptors</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">src_image</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">tgt_keypoints</span><span class="p">,</span> <span class="n">tgt_descriptors</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="n">detectAndCompute</span><span class="p">(</span><span class="n">tgt_image</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">matcher</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BFMatcher</span><span class="p">(</span><span class="n">crossCheck</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">src_descriptors</span><span class="p">,</span> <span class="n">tgt_descriptors</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">matches</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>

    <span class="n">src_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tgt_points</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">src_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src_keypoints</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">queryIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
        <span class="n">tgt_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tgt_keypoints</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">trainIdx</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">)</span>
    <span class="n">src_points</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">src_points</span><span class="p">)</span>
    <span class="n">tgt_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">tgt_points</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">src_points</span><span class="p">,</span> <span class="n">tgt_points</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.plane_coords" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plane_coords</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">depth_hypos</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Batched PyTorch version</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plane_coords</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">depth_hypos</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Batched PyTorch version</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_size</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">num_planes</span> <span class="o">=</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">movedim</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">W</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">W</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">H</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">K</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">K_44</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="n">K_44</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">K_44</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">K_44</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">K</span> <span class="o">@</span> <span class="n">P</span>
    <span class="n">inv_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">proj</span><span class="p">)</span>

    <span class="n">planes</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_planes</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">inv_proj</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_planes</span><span class="p">):</span>
        <span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">inv_proj</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span> <span class="o">@</span> <span class="n">xyz</span><span class="p">)</span> <span class="o">*</span> <span class="n">depth_hypos</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
        <span class="n">planes</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">+=</span> <span class="n">inv_proj</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">planes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.project_depth_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">project_depth_map</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">KP_inv</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Projects a depth map into a list of 3D points</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>depth</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input depth map to project.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cam</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera parameters for input depth map.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A float Tensor of 3D points corresponding to the projected depth values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">project_depth_map</span><span class="p">(</span><span class="n">depth</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">KP_inv</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Projects a depth map into a list of 3D points</span>

<span class="sd">    Parameters:</span>
<span class="sd">        depth: Input depth map to project.</span>
<span class="sd">        cam: Camera parameters for input depth map.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A float Tensor of 3D points corresponding to the projected depth values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># separate into rotation and translation components</span>
    <span class="n">bwd_rotation</span> <span class="o">=</span> <span class="n">KP_inv</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">bwd_translation</span> <span class="o">=</span> <span class="n">KP_inv</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

    <span class="c1"># build 2D homogeneous coordinates tensor: [3, H*W]</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">row_span</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
        <span class="n">col_span</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
        <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">row_span</span><span class="p">,</span> <span class="n">col_span</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
        <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">contiguous</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
        <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="n">width</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="n">width</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">c</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># compute 3D coordinates using the depth map: [H*W, 3]</span>
    <span class="n">world_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">bwd_rotation</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">world_coords</span> <span class="o">=</span> <span class="n">world_coords</span> <span class="o">*</span> <span class="n">depth</span>
    <span class="n">world_coords</span> <span class="o">=</span> <span class="n">world_coords</span> <span class="o">+</span> <span class="n">bwd_translation</span>

    <span class="k">return</span> <span class="n">world_coords</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.project_depth_map_batched" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">project_depth_map_batched</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">cam</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Projects a depth map into a list of 3D points</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>depth</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input depth map to project.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cam</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera parameters for input depth map.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A float Tensor of 3D points corresponding to the projected depth values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">project_depth_map_batched</span><span class="p">(</span><span class="n">depth</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">cam</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Projects a depth map into a list of 3D points</span>

<span class="sd">    Parameters:</span>
<span class="sd">        depth: Input depth map to project.</span>
<span class="sd">        cam: Camera parameters for input depth map.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A float Tensor of 3D points corresponding to the projected depth values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">depth</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">batch_size</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">cam_shape</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># get camera extrinsics and intrinsics</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">cam</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:,:]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">cam</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,:,:]</span>
    <span class="n">K</span><span class="p">[:,</span><span class="mi">3</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># construct back-projection from invers matrices</span>
    <span class="c1"># separate into rotation and translation components</span>
    <span class="n">bwd_projection</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">P</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">K</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">bwd_rotation</span> <span class="o">=</span> <span class="n">bwd_projection</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">bwd_translation</span> <span class="o">=</span> <span class="n">bwd_projection</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>

    <span class="c1"># build 2D homogeneous coordinates tensor: [B, 3, H*W]</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">row_span</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
        <span class="n">col_span</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
        <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">row_span</span><span class="p">,</span> <span class="n">col_span</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
        <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">contiguous</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
        <span class="n">r</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="n">width</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="o">*</span><span class="n">width</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">c</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># compute 3D coordinates using the depth map: [B, H*W, 3]</span>
    <span class="n">world_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">bwd_rotation</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">world_coords</span> <span class="o">=</span> <span class="n">world_coords</span> <span class="o">*</span> <span class="n">depth</span>
    <span class="n">world_coords</span> <span class="o">=</span> <span class="n">world_coords</span> <span class="o">+</span> <span class="n">bwd_translation</span>

    <span class="c1">#TODO: make sure index select is differentiable</span>
    <span class="c1">#       (there is a backward function but need to find the code..)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mask</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">world_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="n">world_coords</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">non_zero_inds</span><span class="p">)</span>
        <span class="n">world_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">movedim</span><span class="p">(</span><span class="n">world_coords</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># reshape 3D coordinates back into 2D map: [B, H, W, 3]</span>
    <span class="c1">#   coords_map = world_coords.reshape(batch_size, height, width, 3)</span>

    <span class="k">return</span> <span class="n">world_coords</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.project_renderer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">project_renderer</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Projects the scene in an Open3D Offscreen Renderer to the 2D image plane.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>renderer</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.o3d.visualization.rendering.OffscreenRenderer">OffscreenRenderer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometric scene to be projected.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>K</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera intrinsic parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>P</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera extrinsic parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired image width.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired image height.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rendered image for the scene at the specified camera viewpoint.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">project_renderer</span><span class="p">(</span><span class="n">renderer</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">OffscreenRenderer</span><span class="p">,</span> <span class="n">K</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Projects the scene in an Open3D Offscreen Renderer to the 2D image plane.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        renderer: Geometric scene to be projected.</span>
<span class="sd">        K: Camera intrinsic parameters.</span>
<span class="sd">        P: Camera extrinsic parameters.</span>
<span class="sd">        width: Desired image width.</span>
<span class="sd">        height: Desired image height.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The rendered image for the scene at the specified camera viewpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set up the renderer</span>
    <span class="n">intrins</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">PinholeCameraIntrinsic</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">renderer</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="n">intrins</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>

    <span class="c1"># render image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">renderer</span><span class="o">.</span><span class="n">render_to_image</span><span class="p">())</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.psv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">psv</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">,</span> <span class="n">extrinsics</span><span class="p">,</span> <span class="n">depth_hypos</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Performs homography warping to create a Plane Sweeping Volume (PSV).
Parameters:
    cfg: Configuration dictionary containing configuration parameters.
    images: image maps to be warped into a PSV.
    intrinsics: intrinsics matrices.
    extrinsics: extrinsics matrices.
    depth_hypos: Depth hypotheses to use for homography warping.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plane Sweeping Volume computed via feature matching cost.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">psv</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">,</span> <span class="n">extrinsics</span><span class="p">,</span> <span class="n">depth_hypos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs homography warping to create a Plane Sweeping Volume (PSV).</span>
<span class="sd">    Parameters:</span>
<span class="sd">        cfg: Configuration dictionary containing configuration parameters.</span>
<span class="sd">        images: image maps to be warped into a PSV.</span>
<span class="sd">        intrinsics: intrinsics matrices.</span>
<span class="sd">        extrinsics: extrinsics matrices.</span>
<span class="sd">        depth_hypos: Depth hypotheses to use for homography warping.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Plane Sweeping Volume computed via feature matching cost.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">depth_hypos</span> <span class="o">=</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">planes</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">B</span><span class="p">,</span><span class="n">views</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">pairwise_psv</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">views</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">src_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">intrinsics</span><span class="p">[:,</span><span class="n">v</span><span class="p">],</span> <span class="n">extrinsics</span><span class="p">[:,</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">ref_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">intrinsics</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">extrinsics</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]]])</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">src_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">src_proj</span><span class="p">,</span><span class="n">last</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ref_proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">ref_proj</span><span class="p">,</span><span class="n">last</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">proj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">src_proj</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">ref_proj</span><span class="p">))</span>
            <span class="n">rot</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># [B,3,3]</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">proj</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># [B,3,1]</span>

            <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">images</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                                <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">images</span><span class="o">.</span><span class="n">device</span><span class="p">)],</span>
                                <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">contiguous</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">W</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1"># [3, H*W]</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B, 3, H*W]</span>
            <span class="n">rot_xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">rot</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>  <span class="c1"># [B, 3, H*W]</span>

            <span class="n">rot_depth_xyz</span> <span class="o">=</span> <span class="n">rot_xyz</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">depth_hypos</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">H</span><span class="o">*</span><span class="n">W</span><span class="p">)</span>  <span class="c1"># [B, 3, Ndepth, H*W]</span>
            <span class="n">proj_xyz</span> <span class="o">=</span> <span class="n">rot_depth_xyz</span> <span class="o">+</span> <span class="n">trans</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># [B, 3, Ndepth, H*W]</span>
            <span class="n">proj_xy</span> <span class="o">=</span> <span class="n">proj_xyz</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="n">proj_xyz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>  <span class="c1"># [B, 2, Ndepth, H*W]</span>
            <span class="n">proj_x_normalized</span> <span class="o">=</span> <span class="n">proj_xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="p">((</span><span class="n">W</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">proj_y_normalized</span> <span class="o">=</span> <span class="n">proj_xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="p">((</span><span class="n">H</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">proj_xy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">proj_x_normalized</span><span class="p">,</span> <span class="n">proj_y_normalized</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># [B, Ndepth, H*W, 2]</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">proj_xy</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">warped_src_image</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span> <span class="n">images</span><span class="p">[:,</span><span class="n">v</span><span class="p">],</span>
                                        <span class="n">grid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">planes</span> <span class="o">*</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
                                        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span>
                                        <span class="n">padding_mode</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
                                        <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">pairwise_psv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">warped_src_image</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">pairwise_psv</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_cams_sfm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_cams_sfm</span><span class="p">(</span><span class="n">camera_path</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;cam.txt&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads an entire directory of camera files in SFM format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>camera_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the directory of camera files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extension</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File extension being used for the camera files.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cam.txt&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of camera extrinsics, intrinsics, and view metadata (Nx2x4x4).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_cams_sfm</span><span class="p">(</span><span class="n">camera_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cam.txt&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads an entire directory of camera files in SFM format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        camera_path: Path to the directory of camera files.</span>
<span class="sd">        extension: File extension being used for the camera files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of camera extrinsics, intrinsics, and view metadata (Nx2x4x4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cam_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">camera_path</span><span class="p">)</span>
    <span class="n">cam_files</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">cams</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">cf</span> <span class="ow">in</span> <span class="n">cam_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cf</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">extension</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">cam_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">camera_path</span><span class="p">,</span><span class="n">cf</span><span class="p">)</span>
        <span class="c1">#with open(cam_path,&#39;r&#39;) as f:</span>
        <span class="n">cam</span> <span class="o">=</span> <span class="n">read_single_cam_sfm</span><span class="p">(</span><span class="n">cam_path</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>
        <span class="n">cams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cam</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cams</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_cams_trajectory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_cams_trajectory</span><span class="p">(</span><span class="n">log_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads camera file in Trajectory File format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>log_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input *.log file to be read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of camera extrinsics, intrinsics, and view metadata (Nx2x4x4).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_cams_trajectory</span><span class="p">(</span><span class="n">log_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads camera file in Trajectory File format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        log_file: Input *.log file to be read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of camera extrinsics, intrinsics, and view metadata (Nx2x4x4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cams</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">cam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="c1"># read extrinsic</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                <span class="n">cam</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
            <span class="n">cam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cam</span><span class="p">)</span>

            <span class="n">cams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cam</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cams</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_cluster_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_cluster_list</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads a cluster list file encoding supporting camera viewpoints.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file encoding per-camera viewpoints.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="typing.List">List</span>[<span title="int">int</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array of tuples encoding (ref_view, [src_1,src_2,..])</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_cluster_list</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a cluster list file encoding supporting camera viewpoints.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        filename: Input file encoding per-camera viewpoints.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An array of tuples encoding (ref_view, [src_1,src_2,..])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">num_views</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="n">all_views</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num_views</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">view_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_views</span><span class="p">):</span>
            <span class="n">ref_view</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
            <span class="n">src_views</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_views</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ref_view</span><span class="p">,</span> <span class="n">src_views</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_extrinsics_tum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_extrinsics_tum</span><span class="p">(</span><span class="n">tum_file</span><span class="p">,</span> <span class="n">key_frames</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads extrinsic camera trajectories in TUM format [timestamp tx ty tz qx qy qz qw].</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tum_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input extrinsics file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>key_frames</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Indices corresponding to the desired keyframes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of camera extrinsics (Nx4x4).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_extrinsics_tum</span><span class="p">(</span><span class="n">tum_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key_frames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads extrinsic camera trajectories in TUM format [timestamp tx ty tz qx qy qz qw].</span>

<span class="sd">    Parameters:</span>
<span class="sd">        tum_file: Input extrinsics file.</span>
<span class="sd">        key_frames: Indices corresponding to the desired keyframes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of camera extrinsics (Nx4x4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rot_interval</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">max_rot_angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span>

    <span class="n">extrinsics</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tum_file</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">l</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

            <span class="n">R</span> <span class="o">=</span> <span class="n">rot</span><span class="o">.</span><span class="n">from_quat</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">R</span><span class="nd">@t</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">P</span><span class="p">[:</span><span class="mi">3</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span>
            <span class="n">P</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">extrinsics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

            <span class="k">if</span><span class="p">((</span><span class="n">key_frames</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">key_frames</span><span class="p">)):</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_rot_angle</span><span class="p">,</span> <span class="n">rot_interval</span><span class="p">)</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">max_rot_angle</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">max_rot_angle</span><span class="p">),</span> <span class="n">rot_interval</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">max_rot_angle</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">rot_interval</span><span class="p">)</span>
                <span class="n">thetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">center</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
                    <span class="n">new_P</span> <span class="o">=</span> <span class="n">y_axis_rotation</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
                    <span class="n">extrinsics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_P</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">extrinsics</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_matrix</span><span class="p">(</span><span class="n">mat_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads a single matrix of float values from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mat_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input file for the matrix to be read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The matrix stored in the given file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_matrix</span><span class="p">(</span><span class="n">mat_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a single matrix of float values from a file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        mat_file: Input file for the matrix to be read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The matrix stored in the given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mat_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">row</span><span class="p">]</span>
            <span class="n">M</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">M</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_mesh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_mesh</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads a mesh from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input mesh file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="open3d.geometry.TriangleMesh">TriangleMesh</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mesh stored in the given file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_mesh</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a mesh from a file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        mesh_file: Input mesh file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The mesh stored in the given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_triangle_mesh</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_pfm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_pfm</span><span class="p">(</span><span class="n">pfm_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads a file in *.pfm format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pfm_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input *.pfm file to be read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data map that was stored in the *.pfm file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_pfm</span><span class="p">(</span><span class="n">pfm_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a file in *.pfm format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pfm_file: Input *.pfm file to be read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Data map that was stored in the *.pfm file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pfm_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pfm_file</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">height</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">pfm_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;iso8859_15&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;PF&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">header</span> <span class="o">==</span> <span class="s1">&#39;Pf&#39;</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Not a PFM file.&#39;</span><span class="p">)</span>
        <span class="n">dim_match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\d+)\s(\d+)\s$&#39;</span><span class="p">,</span> <span class="n">pfm_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;iso8859_15&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">dim_match</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">dim_match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Malformed PFM header.&#39;</span><span class="p">)</span>
        <span class="c1"># scale = float(file.readline().rstrip())</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">pfm_file</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;iso8859_15&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># little-endian</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;&lt;f&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;&gt;f&#39;</span> <span class="c1"># big-endian</span>
        <span class="n">data_string</span> <span class="o">=</span> <span class="n">pfm_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data_string</span><span class="p">,</span> <span class="n">data_type</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">color</span> <span class="k">else</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_point_cloud" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">point_cloud_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads a point cloud from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>point_cloud_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input point cloud file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="open3d.geometry.PointCloud">PointCloud</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The point cloud stored in the given file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_point_cloud</span><span class="p">(</span><span class="n">point_cloud_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a point cloud from a file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        point_cloud_file: Input point cloud file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The point cloud stored in the given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">point_cloud_file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_point_cloud_np" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_point_cloud_np</span><span class="p">(</span><span class="n">point_cloud_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads a point cloud from a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>point_cloud_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input point cloud file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.geometry.NDArray">NDArray</span>[<span title="numpy.float32">float32</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The point cloud as an NDArray stored in the given file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_point_cloud_np</span><span class="p">(</span><span class="n">point_cloud_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a point cloud from a file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        point_cloud_file: Input point cloud file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The point cloud as an NDArray stored in the given file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cloud</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_point_cloud</span><span class="p">(</span><span class="n">point_cloud_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cloud</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_single_cam_sfm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_single_cam_sfm</span><span class="p">(</span><span class="n">cam_file</span><span class="p">,</span> <span class="n">depth_planes</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads a single camera file in SFM format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cam_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input camera file to be read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>depth_planes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of depth planes to store in the view metadata.</p>
              </div>
            </td>
            <td>
                  <code>256</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera extrinsics, intrinsics, and view metadata (2x4x4).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_single_cam_sfm</span><span class="p">(</span><span class="n">cam_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">depth_planes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a single camera file in SFM format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        cam_file: Input camera file to be read.</span>
<span class="sd">        depth_planes: Number of depth planes to store in the view metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Camera extrinsics, intrinsics, and view metadata (2x4x4).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cam_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cam_file</span><span class="p">:</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">cam_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">words_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

    <span class="c1"># read extrinsic</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">extrinsic_index</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">cam</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">extrinsic_index</span><span class="p">])</span>

    <span class="c1"># read intrinsic</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">intrinsic_index</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">18</span>
            <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="n">intrinsic_index</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">words_len</span> <span class="o">==</span> <span class="mi">29</span><span class="p">:</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">27</span><span class="p">])</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">28</span><span class="p">])</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_planes</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">words_len</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">27</span><span class="p">])</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">28</span><span class="p">])</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">29</span><span class="p">])</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">words_len</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">28</span><span class="p">])</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">29</span><span class="p">])</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">30</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cam</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">cam</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.read_stereo_intrinsics_yaml" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_stereo_intrinsics_yaml</span><span class="p">(</span><span class="n">intrinsics_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads intrinsics information for a stereo camera pair from a *.yaml file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>intrinsics_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input *.yaml file storing the intrinsics information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>K_left</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsics matrix (3x3) of left camera.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>D_left</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distortion coefficients vector (1x4) of left camera.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>K_right</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsics matrix (3x3) of right camera.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>D_right</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Distortion coefficients vector (1x4) of right camera.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>R</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relative rotation matrix (3x3) from left -&gt; right cameras.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>T</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relative translation vector (1x3) from left -&gt; right cameras.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_stereo_intrinsics_yaml</span><span class="p">(</span><span class="n">intrinsics_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> \
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> \
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> \
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> \
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> \
                                                                <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads intrinsics information for a stereo camera pair from a *.yaml file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        intrinsics_file: Input *.yaml file storing the intrinsics information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        K_left: Intrinsics matrix (3x3) of left camera.</span>
<span class="sd">        D_left: Distortion coefficients vector (1x4) of left camera.</span>
<span class="sd">        K_right: Intrinsics matrix (3x3) of right camera.</span>
<span class="sd">        D_right: Distortion coefficients vector (1x4) of right camera.</span>
<span class="sd">        R: Relative rotation matrix (3x3) from left -&gt; right cameras.</span>
<span class="sd">        T: Relative translation vector (1x3) from left -&gt; right cameras.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">K_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">D_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">K_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">D_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

    <span class="n">cv_file</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FileStorage</span><span class="p">(</span><span class="n">intrinsics_file</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">FILE_STORAGE_READ</span><span class="p">)</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">cv_file</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="n">K_left</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>
    <span class="n">D_left</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>

    <span class="n">right</span> <span class="o">=</span> <span class="n">cv_file</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="n">K_right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>
    <span class="n">D_right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>

    <span class="n">R</span> <span class="o">=</span> <span class="n">cv_file</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">cv_file</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mat</span><span class="p">()</span>

    <span class="n">cv_file</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">K_left</span><span class="p">,</span> <span class="n">D_left</span><span class="p">,</span> <span class="n">K_right</span><span class="p">,</span> <span class="n">D_right</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.render_custom_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">render_custom_values</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span> <span class="n">cam</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Renders a point cloud into a 2D camera plane using custom values for each pixel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of 3D points to be rendered.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of values to be written in the rendered image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_shape</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired shape (height,width) of the rendered image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cam</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera parameters for the image viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rendered image for the list of points using the sepcified corresponding values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render_custom_values</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">int</span><span class="p">],</span> <span class="n">cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renders a point cloud into a 2D camera plane using custom values for each pixel.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        points: List of 3D points to be rendered.</span>
<span class="sd">        values: List of values to be written in the rendered image.</span>
<span class="sd">        image_shape: Desired shape (height,width) of the rendered image.</span>
<span class="sd">        cam: Camera parameters for the image viewpoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The rendered image for the list of points using the sepcified corresponding values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
    <span class="n">cam</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">rendered_img</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">image_shape</span><span class="p">),</span> <span class="n">points</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">cam</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rendered_img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.render_point_cloud" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">render_point_cloud</span><span class="p">(</span><span class="n">render</span><span class="p">,</span> <span class="n">intrins</span><span class="p">,</span> <span class="n">pose</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Renders a point cloud into a 2D image plane.</p>
<p>Parameters:</p>
<p>Returns:</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render_point_cloud</span><span class="p">(</span><span class="n">render</span><span class="p">,</span> <span class="n">intrins</span><span class="p">,</span> <span class="n">pose</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renders a point cloud into a 2D image plane.</span>

<span class="sd">    Parameters:</span>

<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">render</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="n">intrins</span><span class="p">,</span> <span class="n">pose</span><span class="p">)</span>

    <span class="c1"># render image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">render</span><span class="o">.</span><span class="n">render_to_image</span><span class="p">())</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

    <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">render</span><span class="o">.</span><span class="n">render_to_depth_image</span><span class="p">(</span><span class="n">z_in_view_space</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">depth</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.render_point_cloud_single" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">render_point_cloud_single</span><span class="p">(</span><span class="n">cloud</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Renders a point cloud into a 2D image plane.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cloud</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.o3d.geometry.PointCloud">PointCloud</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Point cloud to be rendered.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pose</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera extrinsic parameters for the image plane.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>K</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera intrinsic parameters for the image plane.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired width of the rendered image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired height of the rendered image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rendered image for the point cloud at the specified camera viewpoint.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render_point_cloud_single</span><span class="p">(</span><span class="n">cloud</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">PointCloud</span><span class="p">,</span> <span class="n">pose</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">K</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Renders a point cloud into a 2D image plane.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        cloud: Point cloud to be rendered.</span>
<span class="sd">        pose: Camera extrinsic parameters for the image plane.</span>
<span class="sd">        K: Camera intrinsic parameters for the image plane.</span>
<span class="sd">        width: Desired width of the rendered image.</span>
<span class="sd">        height: Desired height of the rendered image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The rendered image for the point cloud at the specified camera viewpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#   cmap = plt.get_cmap(&quot;hot_r&quot;)</span>
    <span class="c1">#   colors = cmap(dists)[:, :3]</span>
    <span class="c1">#   ply.colors = o3d.utility.Vector3dVector(colors)</span>

    <span class="c1"># set up the renderer</span>
    <span class="n">render</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">OffscreenRenderer</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">visualization</span><span class="o">.</span><span class="n">rendering</span><span class="o">.</span><span class="n">MaterialRecord</span><span class="p">()</span>
    <span class="n">mat</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="s1">&#39;defaultUnlit&#39;</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">add_geometry</span><span class="p">(</span><span class="s2">&quot;cloud&quot;</span><span class="p">,</span> <span class="n">cloud</span><span class="p">,</span> <span class="n">mat</span><span class="p">)</span>
    <span class="n">render</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span> <span class="c1">#r,g,b,a</span>
    <span class="n">intrins</span> <span class="o">=</span> <span class="n">o3d</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">PinholeCameraIntrinsic</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">render</span><span class="o">.</span><span class="n">setup_camera</span><span class="p">(</span><span class="n">intrins</span><span class="p">,</span> <span class="n">pose</span><span class="p">)</span>

    <span class="c1"># render image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">render</span><span class="o">.</span><span class="n">render_to_image</span><span class="p">())</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

    <span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">render</span><span class="o">.</span><span class="n">render_to_depth_image</span><span class="p">(</span><span class="n">z_in_view_space</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">depth</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.reproject" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reproject</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_K</span><span class="p">,</span> <span class="n">src_P</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_K</span><span class="p">,</span> <span class="n">tgt_P</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the re-projection depth values and pixel indices between two depth maps.</p>
<p>This function takes as input two depth maps: 'src_depth' and 'tgt_depth'. The source
depth map is first projected into the target camera plane using the source depth
values and the camera parameters for both views. Using the projected pixel
coordinates in the target view, the target depths are then re-projected back into
the source camera plane (again with the camera parameters for both views). The
information prouced from this process is often used to compute errors in
re-projection between two depth maps, or similar operations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_depth</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source depth map to be projected.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_K</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsic camera parameters for the source depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_P</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extrinsic camera parameters for the source depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_depth</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target depth map used for re-projection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_K</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Intrinsic camera parameters for the target depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tgt_P</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Extrinsic camera parameters for the target depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>depth_reprojected</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The re-projected depth values for the source depth map.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>coords_reprojected</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The re-projection coordinates for the source view.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>coords_tgt</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The projected coordinates for the target view.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reproject</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_K</span><span class="p">,</span> <span class="n">src_P</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_K</span><span class="p">,</span> <span class="n">tgt_P</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the re-projection depth values and pixel indices between two depth maps.</span>

<span class="sd">    This function takes as input two depth maps: &#39;src_depth&#39; and &#39;tgt_depth&#39;. The source</span>
<span class="sd">    depth map is first projected into the target camera plane using the source depth</span>
<span class="sd">    values and the camera parameters for both views. Using the projected pixel</span>
<span class="sd">    coordinates in the target view, the target depths are then re-projected back into</span>
<span class="sd">    the source camera plane (again with the camera parameters for both views). The</span>
<span class="sd">    information prouced from this process is often used to compute errors in</span>
<span class="sd">    re-projection between two depth maps, or similar operations.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        src_depth: Source depth map to be projected.</span>
<span class="sd">        src_K: Intrinsic camera parameters for the source depth map viewpoint.</span>
<span class="sd">        src_P: Extrinsic camera parameters for the source depth map viewpoint.</span>
<span class="sd">        tgt_depth: Target depth map used for re-projection.</span>
<span class="sd">        tgt_K: Intrinsic camera parameters for the target depth map viewpoint.</span>
<span class="sd">        tgt_P: Extrinsic camera parameters for the target depth map viewpoint.</span>

<span class="sd">    Returns:</span>
<span class="sd">        depth_reprojected: The re-projected depth values for the source depth map.</span>
<span class="sd">        coords_reprojected: The re-projection coordinates for the source view.</span>
<span class="sd">        coords_tgt: The projected coordinates for the target view.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_size</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">src_depth</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># back-project ref depths to 3D</span>
    <span class="n">x_src</span><span class="p">,</span> <span class="n">y_src</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>
    <span class="n">x_src</span> <span class="o">=</span> <span class="n">x_src</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_depth</span><span class="p">)</span>
    <span class="n">y_src</span> <span class="o">=</span> <span class="n">y_src</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">src_depth</span><span class="p">)</span>
    <span class="n">homog</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_src</span><span class="p">,</span> <span class="n">y_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_src</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xyz_src</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">src_K</span><span class="p">),</span> <span class="n">homog</span> <span class="o">*</span> <span class="n">src_depth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># transform 3D points from ref to src coords</span>
    <span class="n">homog_3d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xyz_src</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_src</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xyz_tgt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">tgt_P</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">src_P</span><span class="p">)),</span> <span class="n">homog_3d</span><span class="p">)[:,:</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># project src 3D points into pixel coords</span>
    <span class="n">K_xyz_tgt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">tgt_K</span><span class="p">,</span> <span class="n">xyz_tgt</span><span class="p">)</span>
    <span class="n">xy_tgt</span> <span class="o">=</span> <span class="n">K_xyz_tgt</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">K_xyz_tgt</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">x_tgt</span> <span class="o">=</span> <span class="n">xy_tgt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y_tgt</span> <span class="o">=</span> <span class="n">xy_tgt</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">coords_tgt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_tgt</span><span class="p">,</span> <span class="n">y_tgt</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># B x H x W x 2</span>

    <span class="c1"># sample the depth values from the src map at each pixel coord</span>
    <span class="n">x_normalized</span> <span class="o">=</span> <span class="p">((</span><span class="n">x_tgt</span> <span class="o">/</span> <span class="p">(</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">y_normalized</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_tgt</span> <span class="o">/</span> <span class="p">(</span><span class="n">height</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_normalized</span><span class="p">,</span> <span class="n">y_normalized</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># B x H x W x 2</span>
    <span class="n">sampled_depth_tgt</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
                                    <span class="n">tgt_depth</span><span class="p">,</span>
                                    <span class="n">grid</span><span class="p">,</span>
                                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
                                    <span class="n">padding_mode</span><span class="o">=</span><span class="s2">&quot;zeros&quot;</span><span class="p">,</span>
                                    <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># back-project src depths to 3D</span>
    <span class="n">homog</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xy_tgt</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_src</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xyz_tgt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">tgt_K</span><span class="p">),</span> <span class="n">homog</span> <span class="o">*</span> <span class="n">sampled_depth_tgt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># transform 3D points from src to ref coords</span>
    <span class="n">homog_3d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xyz_tgt</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_src</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xyz_reprojected</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">src_P</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">tgt_P</span><span class="p">)),</span> <span class="n">homog_3d</span><span class="p">)[:,:</span><span class="mi">3</span><span class="p">]</span>

    <span class="c1"># extract reprojected depth values</span>
    <span class="n">depth_reprojected</span> <span class="o">=</span> <span class="n">xyz_reprojected</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># project ref 3D points into pixel coords</span>
    <span class="n">K_xyz_reprojected</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">src_K</span><span class="p">,</span> <span class="n">xyz_reprojected</span><span class="p">)</span>
    <span class="n">xy_reprojected</span> <span class="o">=</span> <span class="n">K_xyz_reprojected</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">K_xyz_reprojected</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">)</span>
    <span class="n">x_reprojected</span> <span class="o">=</span> <span class="n">xy_reprojected</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y_reprojected</span> <span class="o">=</span> <span class="n">xy_reprojected</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">coords_reprojected</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_reprojected</span><span class="p">,</span> <span class="n">y_reprojected</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># B x H x W x 2</span>

    <span class="k">return</span> <span class="n">depth_reprojected</span><span class="p">,</span> <span class="n">coords_reprojected</span><span class="p">,</span> <span class="n">coords_tgt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.resolution_based_hypothesis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resolution_based_hypothesis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_hypo</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">,</span> <span class="n">min_hypo</span><span class="p">,</span> <span class="n">max_hypo</span><span class="p">,</span> <span class="n">delta_in</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parameters:</p>
<p>Returns:</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">resolution_based_hypothesis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_hypo</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">,</span> <span class="n">min_hypo</span><span class="p">,</span> <span class="n">max_hypo</span><span class="p">,</span> <span class="n">delta_in</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>

<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">target_hypo</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">rand_match_offset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target_hypo</span><span class="p">)</span>
    <span class="n">rand_near_offset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target_hypo</span><span class="p">)</span>
    <span class="n">rand_far_offset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target_hypo</span><span class="p">)</span>

    <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="o">=</span> <span class="n">z_planes_from_disp</span><span class="p">(</span><span class="n">target_hypo</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">],</span> <span class="n">focal_length</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta_in</span><span class="p">)</span>
    <span class="n">target_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">far</span> <span class="o">-</span> <span class="n">near</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">near_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">near</span> <span class="o">-</span> <span class="n">min_hypo</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">far_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_hypo</span> <span class="o">-</span> <span class="n">far</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">target_samples</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand_match_offset</span> <span class="o">*</span> <span class="n">target_range</span><span class="p">)</span> <span class="o">+</span> <span class="n">near</span>
    <span class="n">near_samples</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand_near_offset</span> <span class="o">*</span> <span class="n">near_range</span><span class="p">)</span> <span class="o">+</span> <span class="n">min_hypo</span>
    <span class="n">far_samples</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand_far_offset</span> <span class="o">*</span> <span class="n">far_range</span><span class="p">)</span> <span class="o">+</span> <span class="n">far</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">target_samples</span><span class="p">,</span><span class="n">near_samples</span><span class="p">,</span><span class="n">far_samples</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># [B, 1, M*3, H, W]</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">target_hypo</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">hypos</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">min_hypo</span><span class="p">,</span> <span class="n">max_hypo</span><span class="p">)</span> <span class="o">*</span> <span class="n">mask</span>

    <span class="k">return</span> <span class="n">hypos</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.rigid_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rigid_transform</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Apply's a rigid transform to a collection of 3D points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="cvtkit.common.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of 3D points of size [N x 3]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="cvtkit.common.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>rigid transform to be pre-multiplied of size [4x4]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.typing.NDArray">NDArray</span>[<span title="cvtkit.common.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The transformed 3D points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rigid_transform</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">transform</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Apply&#39;s a rigid transform to a collection of 3D points.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        points: Array of 3D points of size [N x 3]</span>
<span class="sd">        transform: rigid transform to be pre-multiplied of size [4x4]</span>

<span class="sd">    Returns:</span>
<span class="sd">        The transformed 3D points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">homog_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">transform</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">homog_coords</span><span class="p">)[:,:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.sample_volume" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_volume</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">z_vals</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">near_depth</span><span class="p">,</span> <span class="n">far_depth</span><span class="p">,</span> <span class="n">inv_depth</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parameters:</p>
<p>Returns:</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_volume</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">z_vals</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">near_depth</span><span class="p">,</span> <span class="n">far_depth</span><span class="p">,</span> <span class="n">inv_depth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>

<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">z_vals</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">batch_size</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">volume</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">z_vals</span> <span class="o">=</span> <span class="n">z_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># N x M x 1</span>
    <span class="k">if</span> <span class="n">inv_depth</span><span class="p">:</span>
        <span class="n">z_vals</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">z_vals</span>
        <span class="n">near_depth</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">near_depth</span>
        <span class="n">far_depth</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">far_depth</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># N x M x 2</span>
    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">y_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">z_vals</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># N x M x 3</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># N*M x 3</span>

    <span class="c1"># define coordinates bounds</span>
    <span class="n">min_coord</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">near_depth</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">max_coord</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">W</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">H</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">far_depth</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
    <span class="n">min_coord</span> <span class="o">=</span> <span class="n">min_coord</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">max_coord</span> <span class="o">=</span> <span class="n">max_coord</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> 

    <span class="c1"># normalize points</span>
    <span class="n">norm_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span> <span class="o">-</span> <span class="n">min_coord</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_coord</span> <span class="o">-</span> <span class="n">min_coord</span><span class="p">)</span>
    <span class="n">norm_points</span> <span class="o">=</span> <span class="n">norm_points</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">norm_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm_points</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Note: The shape of the input volume is 5D: Batch x Channels x Depth x Height x Width.</span>
    <span class="c1">#       The input coordinates must be in [x, y, z] format where x-&gt;width, y-&gt;height, z-&gt;depth.</span>
    <span class="c1">#       These coordinates must be normalized between [-1, 1].</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span>
                            <span class="n">norm_points</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">N</span><span class="o">*</span><span class="n">M</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span>
                            <span class="n">padding_mode</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">,</span>
                            <span class="n">align_corners</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">movedim</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">N</span><span class="o">*</span><span class="n">M</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># N*M x c</span>

    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.save_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ckpt_model.pth&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Saves model weights to disk.</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ckpt_model.pth&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves model weights to disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ckpt_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;ckpt&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ckpt_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">ckpt_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving model checkpoint to </span><span class="si">{</span><span class="n">ckpt_path</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_folder</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">model_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.soft_hypothesis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">soft_hypothesis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_hypo</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">,</span> <span class="n">min_hypo</span><span class="p">,</span> <span class="n">max_hypo</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">delta_in</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parameters:</p>
<p>Returns:</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">soft_hypothesis</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target_hypo</span><span class="p">,</span> <span class="n">focal_length</span><span class="p">,</span> <span class="n">min_hypo</span><span class="p">,</span> <span class="n">max_hypo</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">delta_in</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>

<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">target_hypo</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">rand_match_offset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target_hypo</span><span class="p">)</span>
    <span class="n">near</span><span class="p">,</span> <span class="n">far</span> <span class="o">=</span> <span class="n">z_planes_from_disp</span><span class="p">(</span><span class="n">target_hypo</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">],</span> <span class="n">focal_length</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta_in</span><span class="p">)</span>
    <span class="n">target_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">far</span> <span class="o">-</span> <span class="n">near</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">target_samples</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand_match_offset</span> <span class="o">*</span> <span class="n">target_range</span><span class="p">)</span> <span class="o">+</span> <span class="n">near</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">target_hypo</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">matching_hypos</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">target_samples</span><span class="p">,</span> <span class="n">min_hypo</span><span class="p">,</span> <span class="n">max_hypo</span><span class="p">)</span> <span class="o">*</span> <span class="n">mask</span>

    <span class="k">return</span> <span class="n">matching_hypos</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.uniform_hypothesis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">uniform_hypothesis</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">depth_min</span><span class="p">,</span> <span class="n">depth_max</span><span class="p">,</span> <span class="n">img_height</span><span class="p">,</span> <span class="n">img_width</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">inv_depth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bin_format</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parameters:</p>
<p>Returns:</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">uniform_hypothesis</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">depth_min</span><span class="p">,</span> <span class="n">depth_max</span><span class="p">,</span> <span class="n">img_height</span><span class="p">,</span> <span class="n">img_width</span><span class="p">,</span> <span class="n">planes</span><span class="p">,</span> <span class="n">inv_depth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bin_format</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>

<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">depth_range</span> <span class="o">=</span> <span class="n">depth_max</span><span class="o">-</span><span class="n">depth_min</span>

    <span class="n">hypotheses</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span><span class="n">planes</span><span class="p">),</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bin_format</span><span class="p">:</span>
            <span class="n">spacing</span> <span class="o">=</span> <span class="n">depth_range</span><span class="o">/</span><span class="n">planes</span>
            <span class="n">start_depth</span> <span class="o">=</span> <span class="n">depth_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">spacing</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">end_depth</span> <span class="o">=</span> <span class="n">depth_min</span> <span class="o">+</span> <span class="p">(</span><span class="n">spacing</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">planes</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">spacing</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_depth</span> <span class="o">=</span> <span class="n">depth_min</span>
            <span class="n">end_depth</span> <span class="o">=</span> <span class="n">depth_max</span>
        <span class="k">if</span> <span class="n">inv_depth</span><span class="p">:</span>
            <span class="n">hypotheses</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">start_depth</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">end_depth</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="n">planes</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hypotheses</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_depth</span><span class="p">,</span> <span class="n">end_depth</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">planes</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">hypotheses</span> <span class="o">=</span> <span class="n">hypotheses</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">img_height</span><span class="p">,</span><span class="n">img_width</span><span class="p">)</span>

    <span class="c1"># Make coordinate for depth hypothesis, to be used by sparse convolution.</span>
    <span class="n">depth_hypo_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span><span class="n">planes</span><span class="p">),</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">depth_hypo_coords</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">planes</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="n">planes</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="n">depth_hypo_coords</span> <span class="o">=</span> <span class="n">depth_hypo_coords</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">img_height</span><span class="p">,</span><span class="n">img_width</span><span class="p">)</span>

    <span class="c1"># Calculate hypothesis interval</span>
    <span class="n">hypo_intervals</span> <span class="o">=</span> <span class="n">hypotheses</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">hypotheses</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">hypo_intervals</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">hypo_intervals</span><span class="p">,</span><span class="n">hypo_intervals</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hypotheses</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">depth_hypo_coords</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">hypo_intervals</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.visibility" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">visibility</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">Ps</span><span class="p">,</span> <span class="n">vis_th</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parameters:</p>
<p>Returns:</p>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visibility</span><span class="p">(</span><span class="n">depths</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">Ps</span><span class="p">,</span> <span class="n">vis_th</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters:</span>

<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">batch_size</span><span class="p">,</span> <span class="n">views</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">depths</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">K_pyr</span> <span class="o">=</span> <span class="n">intrinsic_pyramid</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>

    <span class="n">vis_maps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vis_masks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">):</span>
        <span class="n">resized_depths</span> <span class="o">=</span> <span class="n">tvf</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">depths</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">H</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">l</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">W</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">l</span><span class="p">))])</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">batch_size</span><span class="p">,</span> <span class="n">views</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">resized_depths</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">vis_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">resized_depths</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">views</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">geometric_consistency_mask</span><span class="p">(</span><span class="n">resized_depths</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">K_pyr</span><span class="p">[:,</span><span class="n">l</span><span class="p">],</span> <span class="n">Ps</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">resized_depths</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">K_pyr</span><span class="p">[:,</span><span class="n">l</span><span class="p">],</span> <span class="n">Ps</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">pixel_th</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">vis_map</span> <span class="o">+=</span> <span class="n">mask</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vis_map</span> <span class="o">=</span> <span class="n">vis_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">vis_maps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vis_map</span><span class="p">)</span>
        <span class="n">vis_masks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vis_map</span> <span class="o">&gt;=</span> <span class="n">vis_th</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">vis_maps</span><span class="p">,</span> <span class="n">vis_masks</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.visibility_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">visibility_mask</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_cam</span><span class="p">,</span> <span class="n">depth_files</span><span class="p">,</span> <span class="n">cam_files</span><span class="p">,</span> <span class="n">src_ind</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pixel_th</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes a visibility mask between a provided source depth map and list of target depth maps.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_depth</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Depth map for the source view.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_cam</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera parameters for the source depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>depth_files</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of target depth maps.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cam_files</code>
            </td>
            <td>
                  <code><span title="cvtkit.io.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of corresponding target camera parameters for each targte depth map viewpoint.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_ind</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index into 'depth_files' corresponding to the source depth map (if included in the list).</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_th</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pixel re-projection threshold to determine matching depth estimates.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="cvtkit.io.np.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The visibility mask for the source view.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/geometry.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visibility_mask</span><span class="p">(</span><span class="n">src_depth</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">src_cam</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">depth_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">cam_files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">src_ind</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pixel_th</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes a visibility mask between a provided source depth map and list of target depth maps.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        src_depth: Depth map for the source view.</span>
<span class="sd">        src_cam: Camera parameters for the source depth map viewpoint.</span>
<span class="sd">        depth_files: List of target depth maps.</span>
<span class="sd">        cam_files: List of corresponding target camera parameters for each targte depth map viewpoint.</span>
<span class="sd">        src_ind: Index into &#39;depth_files&#39; corresponding to the source depth map (if included in the list).</span>
<span class="sd">        pixel_th: Pixel re-projection threshold to determine matching depth estimates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The visibility mask for the source view.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">src_depth</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">vis_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">depth_files</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">src_ind</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># get files</span>
        <span class="n">sdf</span> <span class="o">=</span> <span class="n">depth_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">scf</span> <span class="o">=</span> <span class="n">cam_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># load data</span>
        <span class="n">tgt_depth</span> <span class="o">=</span> <span class="n">read_pfm</span><span class="p">(</span><span class="n">sdf</span><span class="p">)</span>
        <span class="n">tgt_cam</span> <span class="o">=</span> <span class="n">read_single_cam_sfm</span><span class="p">(</span><span class="n">scf</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">geometric_consistency_mask</span><span class="p">(</span><span class="n">src_depth</span><span class="p">,</span> <span class="n">src_cam</span><span class="p">,</span> <span class="n">tgt_depth</span><span class="p">,</span> <span class="n">tgt_cam</span><span class="p">,</span> <span class="n">pixel_th</span><span class="p">)</span>
        <span class="n">vis_map</span> <span class="o">+=</span> <span class="n">mask</span>

    <span class="k">return</span> <span class="n">vis_map</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.write_cam_sfm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_cam_sfm</span><span class="p">(</span><span class="n">cam_file</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">,</span> <span class="n">extrinsics</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Writes intrinsic and extrinsic camera parameters to a file in sfm format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cam_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file to be writen to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>intrinsics</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera intrinsic data to be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extrinsics</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Camera extrinsic data to be written.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_cam_sfm</span><span class="p">(</span><span class="n">cam_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">intrinsics</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">extrinsics</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes intrinsic and extrinsic camera parameters to a file in sfm format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        cam_file: The file to be writen to.</span>
<span class="sd">        intrinsics: Camera intrinsic data to be written.</span>
<span class="sd">        extrinsics: Camera extrinsic data to be written.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cam_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;extrinsic</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">extrinsics</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;intrinsic</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">intrinsics</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.write_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">mat_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Writes a single matrix to a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>M</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix to be stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mat_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output file where the given matrix is to be writen.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mat_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes a single matrix to a file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        M: Matrix to be stored.</span>
<span class="sd">        mat_file: Output file where the given matrix is to be writen.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mat_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.write_mesh" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_mesh</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Writes a mesh to a file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mesh_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output mesh file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh</code>
            </td>
            <td>
                  <code><span title="open3d.geometry.TriangleMesh">TriangleMesh</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mesh to be stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_mesh</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">o3d</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TriangleMesh</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes a mesh to a file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        mesh_file: Output mesh file.</span>
<span class="sd">        mesh: Mesh to be stored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">o3d</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_triangle_mesh</span><span class="p">(</span><span class="n">mesh_file</span><span class="p">,</span> <span class="n">mesh</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.write_pfm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_pfm</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">data_map</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Writes a data map to a file in *.pfm format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pfm_file</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output *.pfm file to store the data map.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_map</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data map to be stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value used to scale the data map.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/io.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_pfm</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_map</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes a data map to a file in *.pfm format.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        pfm_file: Output *.pfm file to store the data map.</span>
<span class="sd">        data_map: Data map to be stored.</span>
<span class="sd">        scale: Value used to scale the data map.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pfm_file</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">data_map</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;float32&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Image dtype must be float32.&#39;</span><span class="p">)</span>

        <span class="n">data_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">data_map</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_map</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">data_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># color data_map</span>
            <span class="n">color</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_map</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_map</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">data_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> <span class="c1"># greyscale</span>
            <span class="n">color</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Image must have H x W x 3, H x W x 1 or H x W dimensions.&#39;</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;PF</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">color</span> <span class="k">else</span> <span class="s1">&#39;Pf</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data_map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">pfm_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso8859-15&#39;</span><span class="p">))</span>
        <span class="n">pfm_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso8859-15&#39;</span><span class="p">))</span>

        <span class="n">endian</span> <span class="o">=</span> <span class="n">data_map</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">byteorder</span>

        <span class="k">if</span> <span class="n">endian</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">or</span> <span class="n">endian</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s1">&#39;little&#39;</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="o">-</span><span class="n">scale</span>

        <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">scale</span>
        <span class="n">pfm_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;iso8859-15&#39;</span><span class="p">))</span>

        <span class="n">data_map_string</span> <span class="o">=</span> <span class="n">data_map</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="n">pfm_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data_map_string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="cvtkit.geometry.y_axis_rotation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">y_axis_rotation</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Applies a rotation to the given camera extrinsics matrix along the y-axis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>P</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial extrinsics camera matrix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>theta</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Angle (in radians) to rotate the camera.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rotated extrinsics matrix for the camera.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cvtkit/camera.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">y_axis_rotation</span><span class="p">(</span><span class="n">P</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies a rotation to the given camera extrinsics matrix along the y-axis.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        P: Initial extrinsics camera matrix.</span>
<span class="sd">        theta: Angle (in radians) to rotate the camera.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The rotated extrinsics matrix for the camera.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="n">P_rot</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">P</span>

    <span class="k">return</span> <span class="n">P_rot</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>